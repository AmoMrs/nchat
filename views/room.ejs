<!DOCTYPE html>
<html>
  <head>
    <title><%= title %> - NodeJS Chat</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1.0,user-scalable=no">
    <link rel='stylesheet' href='/css/index.min.css' />
  </head>
  <body>
    <div class="chat-name top-title">
      <span>
        <a class="top-prev" href="/room">&lt;</a>
      </span>
      <span>
        <a class="top-next" href=<%= '/room/' + roomId + '/member' %>>&amp;</a>
      </span>
      <p><%= title %></p>
    </div>
    <div class="chat">
      <div class="chat-ctx-wrap">
        <div class="chat-ctx">
          <ul class="chat-msg-list"></ul>
        </div>
        <div class="chat-more-wrap">
          <ul class="chat-more">
            <li class="chat-emoji-list">
              <ul class="chat-more-box">
              </ul>
              <span>🙂</span>
            </li>
          </ul>
        </div>
        <div class="chat-send">
          <textarea class="chat-msg-send" contenteditable></textarea>
          <div class="chat-send-btn">
            发送
          </div>
        </div>
      </div>
    <script type="text/javascript" src="/js/mobile.js"></script>
    <script type="text/javascript">
      (() => {
        /*
         * Why: Socket的端口和页面端口不一致，所以不能用相对路径，只能用绝对路径。
         * What: 本地开发的Host是localhost，在线的是对应的主机名。因此需要动态获取host名。
         * How: 为了保持开发和部署的一直，使用JS动态输出script标签。
         */
        const socketScriptTag = document.createElement('script')
        const socketScriptSrc = `http://${document.location.hostname}:8087/socket.io/socket.io.js`
        socketScriptTag.src = socketScriptSrc
        document.head.appendChild(socketScriptTag)
        // index.min.js依赖socket.io.js
        // 所以要在socket文件加载完成后再加载index.min.js
        socketScriptTag.onload = () => {
          const indexScriptTag = document.createElement('script')
          indexScriptTag.src = '/js/index.min.js'
          document.body.appendChild(indexScriptTag)
        }
      })()
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/axios/0.16.2/axios.min.js"></script>
  </body>
</html>
